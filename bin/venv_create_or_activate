#!/usr/bin/bash

if [ ! -f pyrightconfig.json ]; then
  poetry install && \
  jq \
    --null-input \
    --arg venv "$(basename $(poetry env info -p))" \
    --arg venvPath "$(dirname $(poetry env info -p))" \
    '{ "venv": $venv, "venvPath": $venvPath }' \
    > pyrightconfig.json
fi

if [ -f pyrightconfig.json ]; then

  # . $(poetry env info --path)/bin/activate

  venvPath=$(cat pyrightconfig.json | jq -r ".venvPath")
  venv=$(cat pyrightconfig.json | jq -r ".venv")
  venvPath="$venvPath/$venv"

  . $venvPath/bin/activate

fi
